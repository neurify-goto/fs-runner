# fs-runner-1 / neurify-goto/fs-runner — プロジェクト概要

- 目的: GAS→GitHub Actionsの連携で、企業サイトの問い合わせフォームを自動探索・分析・送信し、結果をSupabaseに保存するバッチ処理基盤。
- 主要構成:
  - GAS(Private)でのトリガー・レコード収集・Repository Dispatch
  - GitHub ActionsでPythonワーカーを実行（src/* がエントリ）
  - Supabase(Postgres/HTTP API)へ結果保存、キュー(RPC)制御
- 技術スタック:
  - Python 3.x、Playwright、BS4/lxml、requests/httpx、aiohttp、Supabase Python SDK、dotenv
  - ワークフロー: GitHub Actions（.github/workflows/*）
  - データベース: Supabase（RPC/テーブル: companies/send_queue/submissions 等）
- 主要ディレクトリ:
  - src/form_sender: 送信ワーカー本体（analyzer/worker/security/utils/...）。エントリ: src/form_sender_runner.py
  - src/form_finder: フォーム探索（worker/orchestrator/form_explorer）
  - src/form_analyzer: 解析処理（worker, supabase_writer）
  - src/fetch_detail: 企業詳細スクレイピング（browser_manager, detail_extractor 等）
  - config/*.json: 非機密の設定（検出ルール、ボタン語、パフォーマンス、バリデーション、リトライなど）
  - scripts/table_schema/*.sql: テーブル/関数/RPC等のスキーマ定義
  - gas/*: GAS側モジュール（外部・私的環境で実行）
  - tests/*: 単体・ローカル送信テスト（GUIモード含む）
  - docs/*: 機能別ドキュメント
- エントリポイント（Python 実行ファイル例）:
  - フォーム送信: `python src/form_sender_runner.py --targeting-id <id> --config-file <path> [--num-workers N] [--headless auto|true|false]`
  - 形態別ワーカー: `src/form_finder_worker.py`, `src/fetch_detail_worker.py`, `src/form_analyzer_worker.py`
  - Supabase書き込み補助: `src/*_supabase_writer.py`
- CI/CD連携:
  - workflows/form-sender.yml: Repository Dispatch/手動トリガで起動。環境変数 `COMPANY_TABLE`, `SEND_QUEUE_TABLE` により *_extra 切替。
  - TZはAsia/Tokyo（JST）で統一。
- ログ方針:
  - CIログでは企業名/URL/機密値をサニタイズ（`LogSanitizer`）。GASログは私的環境のため企業名/URLはマスク対象外。
  - 最小限ログ、個人情報・資格情報は記録しない。
